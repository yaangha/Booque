<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{ layout/layout }">
<div layout:fragment="content" align ="center">
<head>
<meta charset="UTF-8">

<link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi"
    crossorigin="anonymous">

<!-- include libraries(jQuery, bootstrap) -->
<link
    href="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css"
    rel="stylesheet">
<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script
    src="https://stackpath.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
<!-- include summernote css/js -->
   <link
    href="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.css"
    rel="stylesheet">
   <script
    src="https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.js"></script>
 
 <style>  
    @keyframes  blink-effect {
        50% {
            opacity: 0;
         }
       }

   .blink {
        animation: blink-effect 1s step-end infinite;
        animation-timing-function: step-start, step-end;
     }
  </style> 
  
</head>
    
<!--/* layout/basic-layout.html 파일의 "content" 레이아웃 fragment를 채워 줄 내용 */-->
    
<div class="w-75 container"><!-- 메인 블록 - 삭제해도 될 듯 -->

<div class="row"><!-- main block start -->
<div class="col-2"><!-- 프로필 블록 start -->
    <a th:href="@{ /myPage }"> <!-- 프로필 사진 클릭하면 마이페이지로 이동 -->
       <img th:src="${ user.userImage }" width="200" height="280" class="img-fluid rounded-start">
    </a>
    <div style="font-weight: bold;">
        <span th:text="${ '&nbsp;&nbsp;'+ user.nickName }"></span>
        <span style="font-size: 16px;" th:text="${ '('+ user.username +')' }"></span>
    </div>
    <input /><span>블로그 소개글 넣기</span>
        
    <div>전체 리뷰수</div>
    <div class="h4"><strong>1,004</strong></div>
    
    <br/><br/>
    
    <div class="h5" style="text-align: left;">이런 글은 어떠세요?</div>
    <div class="row my-2">
        <div class="col-1 border bg-dark" style="width:40px; height:40px"></div>
        <div class="col" style="text-align: left;">
            <a>짜라투스트라는 도대체..</a><br/>
            <small style="color:gray;">글 19개</small>
        </div>
    </div>
    <div class="row my-2">
        <div class="col-1 border bg-dark" style="width:40px; height:40px"></div>
        <div class="col" style="text-align: left;">
            <a>김영하가 다다다라는..</a><br/>
            <small style="color:gray;">글 15개</small>
        </div>
    </div>
    <div class="row my-2">
        <div class="col-1 border bg-dark" style="width:40px; height:40px"></div>
        <div class="col" style="text-align: left;">
            <a>오늘도 화이팅이란</a><br/>
            <small style="color:gray;">글 159개</small>
        </div>
    </div>
    <div class="row my-2">
        <div class="col-1 border bg-dark" style="width:40px; height:40px"></div>
        <div class="col" style="text-align: left;">
            <a>트렌드를 따라가려면..</a><br/>
            <small style="color:gray;">글 9개</small>
        </div>
    </div>
    
</div><!-- 프로필 블록 end -->
    
 <div class="col-10"><!-- content block start -->
    <!-- 최근에 본 책 간단 정보 -->
    
     <!-- 예진: 작성한 리뷰가 있을 때만 보여줌. -->
    <div th:if="${ !#lists.isEmpty(list) }">
    <p><span class="h4" th:text="${ user.nickName }"></span>님은 최근에 이 책들의 리뷰를 작성했어요!!</p> 
    </div>
    
    <div class="w-100 rounded"><!-- 최근에 본 책 블록 start -->
        <div class="row container">
            <div class="col" th:each="post : ${ list }">
                <div class="card my-2" style="width: 20rem; height:40rem">
                    <a th:href="@{ /detail?id={bookId} (bookId = ${ post.bookId })}">
                        <img th:src="${ post.bookImage }" class="card-img-top" style="height:30rem" />
                    </a>
                    <div class="card-body" style="text-align: left;">
                        <div class="card-text">
                            <a class="h4" th:href="@{ /post/detail?postId={postId}&bookId={bookId} (postId = ${ post.postId }, bookId = ${ post.bookId } )}" th:text="${ post.title }"></a><br/>
                            <small th:text="${ #temporals.format(post.modifiedTime, 'yyyy-MM-dd') }" style="color:gray;"></small>
                        </div>
                    </div> <!-- card body end -->
                </div> <!-- card end -->
            </div> <!-- col end -->
        </div> <!-- row end -->
    </div><!-- 최근에 본 책 블록 end -->
    
<!-- test용 -->
<div>
             
    <div id="hotPostsSlides" class="carousel slide" data-bs-ride="true" style="border:2px solid white; width: 100%; z-index:0;">
        <div class="carousel-indicators">
            <button type="button" data-bs-target="#hotPostsSlides" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
            <button type="button" data-bs-target="#hotPostsSlides" data-bs-slide-to="1" aria-label="Slide 2"></button>
        </div>
        <div class="carousel-inner w3-border" style="margin-top: 50px;  padding-top:60px; padding-bottom:60px;  padding-left:30px; padding-right:30px;">
            <div class="carousel-item active">
                <div class="w3-quarter">
                     <img class="w3-card" src="https://contents.kyobobook.co.kr/sih/fit-in/458x0/pdt/9791191043754.jpg" style="height:250px; width:auto;" />
                </div>
                <div class="w3-quarter post" style="text-align:left;">
                    <h3>너무 좋은 책이에요!!!</h3>
                    <div class="postContent w3-hover-opacity">
                    <p style="padding-top:60px;">어쨌든 너무 좋은 책입니다.....<br/>표지가 이쁘거든요.....</p>
                    <p>어쨌든 너무 좋은 책입니다.....<br/>표지가 이쁘거든요.....<br/>(미리보기)</p></div>
                </div>
                <div class="w3-quarter">
                    <img class="w3-card" src="https://contents.kyobobook.co.kr/sih/fit-in/458x0/pdt/9791161571188.jpg" style="height: 250px; width:auto;" />
                </div>
                <div class="w3-quarter post" style="text-align:left;">
                    <h3>최고의 책</h3>
                    <div class="postContent w3-hover-opacity">
                    <p style="padding-top:60px;">표지 보고 골랐습니다....<br/>그렇읍니다.........</p>
                    <p>표지 보고 골랐습니다....<br/>그렇읍니다.........<br/>(미리보기)</p></div>
                </div>
            </div>
             <div class="carousel-item">
                <div class="w3-quarter">
                    <img class="w3-card" src="https://contents.kyobobook.co.kr/sih/fit-in/458x0/pdt/9791191114102.jpg" style="height:250px; width:auto;" />
                </div>
                <div class="w3-quarter post" style="text-align:left;">
                    <h3>너무 좋은 책이에요!!!</h3>
                    <div class="postContent w3-hover-opacity">
                    <p style="padding-top:60px;">어쨌든 너무 좋은 책입니다.....<br/>표지가 이쁘거든요.....</p>
                    <p>어쨌든 너무 좋은 책입니다.....<br/>표지가 이쁘거든요.....<br/>(미리보기)</p></div>
                </div>
                <div class="w3-quarter">
                    <img class="w3-card" src="https://contents.kyobobook.co.kr/sih/fit-in/458x0/pdt/9788936438838.jpg" style="height: 250px; width:auto;" />
                </div>
                <div class="w3-quarter post" style="text-align:left;">
                    <h3>최고의 책</h3>
                    <div class="postContent w3-hover-opacity">
                    <p style="padding-top:60px;">표지 보고 골랐습니다....<br/>그렇읍니다.........</p>
                    <p>표지 보고 골랐습니다....<br/>그렇읍니다.........<br/>(미리보기)</p></div>
                </div>
            </div>
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#hotPostsSlides" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#hotPostsSlides" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
        </button>
    </div>
            
</div>
      
    <br/>
    
 <!-- 예진: 작성한 리뷰가 없을 때.  -->   
 <div th:if="${ #lists.isEmpty(list) }">작성한 글이 없습니다.<span style="font-weight: bold; font-size: 20px;">첫 리뷰를 작성해보세요!!</span></div>
 
 <!-- 예진: 작성한 리뷰가 있을 때. -->
 <div th:if="${ !#lists.isEmpty(list) }">
 
    <!-- 사용자 작성 리뷰 리스트(테이블) -->
    <table class="table">
    <thead>
        <tr class="border-bottom border-4 border-dark">
            <td class="col-8">책 리뷰 목록</td>
            <td></td>
        </tr>
    </thead>
    <tbody>
        <tr th:each="post : ${ list }">
            <td class="py-5">
                  <div class="h4">
                   <span th:text="${ post.postId }"></span>
                   
                    <strong><a th:href="@{ /post/detail?postId={postId}&bookId={bookId} (postId = ${ post.postId }, bookId = ${ post.bookId } )}" th:text="${ post.title }" th:postId="${post.postId}" onclick="postHitCountUp(this.getAttribute('postId'));"></a></strong>
                   
                     <!-- 예진:  오늘 작성한 글 new 아이콘 보여주기 -->
                     <div th:if="${ day } == ${ #temporals.format(post.createdTime, 'dd') }">
                      <span>
                        <img class="blink" src="/images/new.png" width="50" height="50" >
                      </span>
                    </div>
                    
                     <!-- 예진: 댓글 수 -->
                     <span>댓글(</span>
                     <span th:text="${ post.replyCount }"></span>
                     <span>)</span>
                     
                     <!-- 예진: 댓글 수 10개 이상인 글 hot 아이콘 보여주기 -->
                     <div th:if="${ post.replyCount } > 9 ">
                      <span>
                        <img  class="blink" src="/images/promotional.png" width="50" height="40" >
                      </span>
                    </div>
                   
                </div>
          
                <small th:text="${ #temporals.format(post.modifiedTime, 'yyyy-MM-dd HH:mm:ss') }" style="color:gray;"></small>
                <!-- 홍찬 -->
                <small>조회수 <span th:text="${post.hit}"></span></small>
            </td>
            <td style="text-align: center;">
                <a style="margin-left: 18px;" th:href="@{ /detail?id={bookId} (bookId = ${ post.bookId })}">
                    <img th:src="${ post.bookImage }" class="img-fluid rounded-start" style="width:120px;">
                </a>
            </td>
       </tr>
    
    </tbody>
    </table>
    </div>
</div><!-- content block end -->
</div><!-- main block end -->

</div><!-- 메인 블록 end -->

<th:block layout:fragment="script" th:inline="javascript">

<!-- summernote -->
  <script>
 $('.summernote').summernote({
    width:830,
      height: 300,
      lang: "ko-KR"
    }); </script>
    

    
    <!-- 포스트 글 조회수 증가-->
    <script>
    function postHitCountUp(postId){
        axios.get('/postHitCount', {params: {postId : postId}})
           .then(response => {
               console.log(response);
               return true;
           })
           .catch(err =>{
               console.log(err);
           });
    }
    </script>
    
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-OERcA2EqjJCMA+/3y+gxIOqMEjwtxJY7qPCqsdltbNJuaOe923+mo//f6V8Qbsw3"
    crossorigin="anonymous">
    </script>
    
</th:block>

  </div><!-- layout:fragment="content" : END -->


</html>